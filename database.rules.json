{
  "rules": {
    ".read": false,
    ".write": false,
    
    "presence": {
      ".read": "auth != null",
      "$userId": {
        ".read": "auth != null",
        ".write": "auth != null && auth.uid == $userId",
        ".validate": "newData.hasChildren(['displayName', 'cursorX', 'cursorY', 'color', 'lastSeen', 'isActive'])",
        "displayName": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "cursorX": {
          ".validate": "newData.isNumber()"
        },
        "cursorY": {
          ".validate": "newData.isNumber()"
        },
        "color": {
          ".validate": "newData.isString() && newData.val().matches(/^#[0-9a-fA-F]{6}$/)"
        },
        "lastSeen": {
          ".validate": "newData.isNumber()"
        },
        "isActive": {
          ".validate": "newData.isBoolean()"
        }
      }
    },
    
    "objectMovements": {
      ".read": "auth != null",
      "$objectId": {
        ".read": "auth != null",
        ".write": "auth != null",
        ".validate": "newData.hasChildren(['x', 'y', 'width', 'height']) && (!newData.hasChild('draggedBy') || newData.child('draggedBy').val() == auth.uid)",
        "x": {
          ".validate": "newData.isNumber()"
        },
        "y": {
          ".validate": "newData.isNumber()"
        },
        "width": {
          ".validate": "newData.isNumber() && newData.val() > 0"
        },
        "height": {
          ".validate": "newData.isNumber() && newData.val() > 0"
        },
        "isDragging": {
          ".validate": "newData.isBoolean()"
        },
        "draggedBy": {
          ".validate": "newData.isString() && newData.val() == auth.uid"
        },
        "timestamp": {
          ".validate": "newData.isNumber()"
        }
      }
    }
  }
}
