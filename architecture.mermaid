graph TB
    subgraph "Client Browser"
        subgraph "React Application"
            APP[App.tsx<br/>Main App Component]
            
            subgraph "Components"
                CANVAS[Canvas.tsx<br/>Main Canvas Container]
                CANVASOBJ[CanvasObject.tsx<br/>Multi-Shape Rendering]
                TOOLBAR[Toolbar.tsx<br/>Shape Creation Tools]
                PRESENCE[PresenceList.tsx<br/>Online Users Display]
                CURSOR[MultiplayerCursor.tsx<br/>Multiplayer Cursors]
                LOGIN[Login.tsx<br/>Auth Form]
                REGISTER[Register.tsx<br/>Registration Form]
                AUTHPROV[AuthProvider.tsx<br/>Auth Context]
                AIUI[AICommandInput.tsx<br/>AI Interface]
            end
            
            subgraph "Performance Layer ðŸš€"
                VIEWPORT[ViewportCulling<br/>Only Render Visible Objects]
                OBJPOOL[ObjectPool<br/>Reuse Konva Objects]
                SPATIAL[SpatialIndex<br/>QuadTree for Fast Queries]
                BATCHER[UpdateBatcher<br/>Batch Firestore Writes]
                THROTTLER[EventThrottler<br/>Reduce Update Frequency]
            end
            
            subgraph "Hooks"
                USECANVAS[useCanvas.ts<br/>Canvas State & Logic]
                USESHAPES[useShapes.ts<br/>Multi-Shape CRUD & Sync]
                USEPRESENCE[usePresence.ts<br/>Cursor & Presence]
                USEAUTH[useAuth.ts<br/>Authentication State]
                USEAI[useAI.ts<br/>AI Command Processing]
                USEPERF[usePerformance.ts<br/>Performance Monitoring]
            end
            
            subgraph "Services"
                FIRESERVICE[firebase.ts<br/>Firebase SDK Init]
                CANVASSERV[canvasService.ts<br/>Shared Canvas Init]
                SHAPESERV[shapesService.ts<br/>Multi-Shape CRUD]
                PRESENCESERV[presenceService.ts<br/>Presence & Heartbeat]
                AISERVICE[aiService.ts<br/>AI Command Processing]
                PERFSERVICE[performanceService.ts<br/>Metrics & Optimization]
            end
            
            subgraph "Utils"
                HELPERS[canvasHelpers.ts<br/>Coordinate Conversion]
                PERFHELPERS[performanceHelpers.ts<br/>Optimization Utils]
                AIHELPERS[aiHelpers.ts<br/>AI Command Parsing]
            end
        end
        
        subgraph "Optimized Rendering Layer ðŸŽ¨"
            KONVA[Konva.js<br/>Canvas Rendering Engine]
            WEBGL[WebGL Layer<br/>Hardware Acceleration]
            OFFSCREEN[OffscreenCanvas<br/>Background Rendering]
        end
    end
    
    subgraph "Firebase Cloud Services"
        subgraph "Firebase Authentication"
            FBAUTH[Firebase Auth<br/>Email/Password]
        end
        
        subgraph "Cloud Firestore - Optimized Structure ðŸ“Š"
            USERS[("users/<br/>User Profiles")]
            CANVAS[("canvas/<br/>Shared Canvas Document")]
            SHAPES[("canvas/shared/shapes/<br/>Batched Shape Documents")]
            PRESENCECOL[("presence/<br/>Live Presence Data")]
            AICOMMANDS[("aiCommands/<br/>AI Command Queue")]
            PERFORMANCE[("performance/<br/>Metrics & Analytics")]
        end
        
        subgraph "External AI Services ðŸ¤–"
            OPENAI[OpenAI GPT-4<br/>Function Calling API]
            CLAUDE[Claude Anthropic<br/>Alternative AI API]
        end
        
        subgraph "Firebase Hosting"
            HOSTING[Static File Hosting<br/>Production Deployment]
        end
    end
    
    subgraph "Development & Testing"
        VITEST[Vitest<br/>Test Runner]
        UNITTESTS[Unit Tests<br/>Services, Hooks, Utils]
        INTTESTS[Integration Tests<br/>Sync, Auth, Persistence]
    end
    
    subgraph "Build Tools"
        VITE[Vite<br/>Build & Dev Server]
        NPM[npm<br/>Package Manager]
    end
    
    %% Component Relationships
    APP --> CANVAS
    APP --> AUTHPROV
    APP --> TOOLBAR
    APP --> PRESENCE
    APP --> AIUI
    
    CANVAS --> CANVASOBJ
    CANVAS --> CURSOR
    CANVAS --> USECANVAS
    CANVAS --> USESHAPES
    CANVAS --> VIEWPORT
    CANVAS --> KONVA
    
    %% Performance Layer Integration
    CANVAS --> VIEWPORT
    CANVAS --> OBJPOOL
    CANVAS --> SPATIAL
    CANVASOBJ --> OBJPOOL
    USESHAPES --> BATCHER
    USEPRESENCE --> THROTTLER
    
    %% Optimized Rendering
    CANVASOBJ --> KONVA
    KONVA --> WEBGL
    VIEWPORT --> OFFSCREEN
    
    CURSOR --> USEPRESENCE
    PRESENCE --> USEPRESENCE
    
    AUTHPROV --> LOGIN
    AUTHPROV --> REGISTER
    AUTHPROV --> USEAUTH
    
    %% AI Integration
    AIUI --> USEAI
    USEAI --> AISERVICE
    
    %% Hook to Service Relationships
    USECANVAS --> HELPERS
    USECANVAS --> CANVASSERV
    USECANVAS --> PERFHELPERS
    
    USESHAPES --> SHAPESERV
    USESHAPES -.Real-time Listener.-> SHAPES
    USESHAPES --> SPATIAL
    
    USEPRESENCE --> PRESENCESERV
    USEPRESENCE --> THROTTLER
    USEPRESENCE -.Real-time Listener.-> PRESENCECOL
    
    USEAUTH --> FIRESERVICE
    
    %% AI Hook Relationships
    USEAI --> AISERVICE
    USEAI --> AIHELPERS
    USEAI -.Command Queue.-> AICOMMANDS
    
    %% Performance Monitoring
    USEPERF --> PERFSERVICE
    USEPERF -.Metrics.-> PERFORMANCE
    
    %% Service to Firebase Relationships
    FIRESERVICE --> FBAUTH
    FIRESERVICE --> USERS
    
    CANVASSERV --> FIRESERVICE
    CANVASSERV --> CANVAS
    
    SHAPESERV --> FIRESERVICE
    SHAPESERV --> SHAPES
    SHAPESERV --> BATCHER
    
    PRESENCESERV --> FIRESERVICE
    PRESENCESERV --> PRESENCECOL
    
    %% AI Service Relationships
    AISERVICE --> FIRESERVICE
    AISERVICE --> AICOMMANDS
    AISERVICE --> OPENAI
    AISERVICE --> CLAUDE
    AISERVICE --> SHAPESERV
    
    %% Performance Service Relationships
    PERFSERVICE --> FIRESERVICE
    PERFSERVICE --> PERFORMANCE
    
    %% Real-time Sync
    SHAPES -.Broadcast Changes.-> USESHAPES
    PRESENCECOL -.Broadcast Changes.-> USEPRESENCE
    
    %% Authentication Flow
    USEAUTH --> FBAUTH
    FBAUTH -.Auth State.-> USEAUTH
    
    %% Testing Relationships
    VITEST --> UNITTESTS
    VITEST --> INTTESTS
    UNITTESTS -.Tests.-> FIRESERVICE
    UNITTESTS -.Tests.-> CANVASSERV
    UNITTESTS -.Tests.-> SHAPESERV
    UNITTESTS -.Tests.-> PRESENCESERV
    UNITTESTS -.Tests.-> USEAUTH
    UNITTESTS -.Tests.-> USESHAPES
    UNITTESTS -.Tests.-> USEPRESENCE
    UNITTESTS -.Tests.-> COLORS
    UNITTESTS -.Tests.-> HELPERS
    
    INTTESTS -.Tests.-> APP
    
    %% Build Pipeline
    NPM --> VITE
    VITE --> APP
    VITE --> HOSTING
    
    %% Styling
    classDef component fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    classDef hook fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef service fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef firebase fill:#fff3e0,stroke:#e65100,stroke-width:3px
    classDef database fill:#ffebee,stroke:#b71c1c,stroke-width:2px
    classDef tool fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    classDef test fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef performance fill:#e8f5e8,stroke:#2e7d2e,stroke-width:3px
    classDef ai fill:#fff4e6,stroke:#ff8f00,stroke-width:3px
    classDef external fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    
    class CANVAS,CANVASOBJ,TOOLBAR,PRESENCE,CURSOR,LOGIN,REGISTER,AUTHPROV,APP,AIUI component
    class USECANVAS,USESHAPES,USEPRESENCE,USEAUTH,USEAI,USEPERF hook
    class FIRESERVICE,CANVASSERV,SHAPESERV,PRESENCESERV,HELPERS,AISERVICE,PERFSERVICE service
    class FBAUTH,HOSTING firebase
    class USERS,CANVAS,SHAPES,PRESENCECOL,AICOMMANDS,PERFORMANCE database
    class VITE,NPM,KONVA,WEBGL,OFFSCREEN tool
    class VITEST,UNITTESTS,INTTESTS test
    class VIEWPORT,OBJPOOL,SPATIAL,BATCHER,THROTTLER performance
    class PERFHELPERS,AIHELPERS service
    class OPENAI,CLAUDE external