<!DOCTYPE html>
<html>
<head>
  <title>Firebase Storage Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    #output {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 5px;
      margin-top: 20px;
      white-space: pre-wrap;
      font-family: monospace;
    }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>Firebase Storage Connection Test</h1>
  
  <div>
    <button onclick="testStorageConnection()">Test Storage Connection</button>
    <button onclick="testFileUpload()">Test File Upload</button>
  </div>
  
  <div id="output"></div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

    const firebaseConfig = {
      apiKey: "AIzaSyBrSXvvYHwsoWeYZkVbpDF8FXpr2wZnq-Y",
      authDomain: "collab-canvas-2e4c5.firebaseapp.com",
      databaseURL: "https://collab-canvas-2e4c5-default-rtdb.firebaseio.com/",
      projectId: "collab-canvas-2e4c5",
      storageBucket: "collab-canvas-2e4c5.firebasestorage.app",
      messagingSenderId: "648585977625",
      appId: "1:648585977625:web:941c261c3e83dbe3cd6f88",
    };

    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);

    const output = document.getElementById('output');
    
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
      output.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
    }

    window.testStorageConnection = function() {
      output.innerHTML = '';
      log('🔍 Testing Firebase Storage connection...', 'info');
      log(`📦 Storage bucket: ${firebaseConfig.storageBucket}`, 'info');
      log(`🎯 Storage instance: ${storage}`, 'info');
      log(`✅ Storage object exists: ${!!storage}`, 'success');
      log(`📍 App name: ${storage.app.name}`, 'info');
    };

    window.testFileUpload = async function() {
      output.innerHTML = '';
      log('🚀 Starting file upload test...', 'info');
      
      try {
        // Create a test blob
        const testData = 'Hello Firebase Storage!';
        const blob = new Blob([testData], { type: 'text/plain' });
        log(`📦 Created test blob: ${blob.size} bytes`, 'info');

        // Create reference
        const testRef = ref(storage, `test/${Date.now()}.txt`);
        log(`📍 Upload path: ${testRef.fullPath}`, 'info');

        // Upload
        log('⏳ Uploading...', 'info');
        const uploadResult = await uploadBytes(testRef, blob);
        log(`✅ Upload successful!`, 'success');
        log(`   Path: ${uploadResult.metadata.fullPath}`, 'success');
        log(`   Size: ${uploadResult.metadata.size} bytes`, 'success');

        // Get download URL
        const downloadURL = await getDownloadURL(testRef);
        log(`🔗 Download URL: ${downloadURL}`, 'success');
        
        log('\n🎉 All tests passed! Firebase Storage is working correctly.', 'success');
      } catch (error) {
        log(`❌ Error: ${error.message}`, 'error');
        log(`   Code: ${error.code}`, 'error');
        log(`   Full error: ${JSON.stringify(error, null, 2)}`, 'error');
        
        if (error.code === 'storage/unauthorized') {
          log('\n💡 Solution: Check Firebase Storage security rules', 'info');
        } else if (error.code === 'storage/bucket-not-found') {
          log('\n💡 Solution: Enable Firebase Storage in the Firebase Console', 'info');
        }
      }
    };

    // Auto-run connection test on load
    window.addEventListener('load', () => {
      setTimeout(testStorageConnection, 500);
    });
  </script>
</body>
</html>

